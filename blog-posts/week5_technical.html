<html>
	<head>
		<title>Refactoring with Chaining and the Ternary Operator</title>
		<link rel="stylesheet" href="../blog_template.css">
		<meta charset=”utf-8”>
	</head>
	<body>
		<div id="header">
		</div>
		<div id="gutter_left">
			<ul>
				<li><a href="https://jbheron.github.io/index.html" target="_blank">Home</li></a>
				<li><a href="https://plus.google.com/106416326851336122136/posts">About Me</a></li>
				<li><a href="mailto:jessheiner@gmail.com">Contact</li></a>
			</ul>	
		</div>

		<div id="main">
			<h1>LeveL Up: Refactoring:</h1>
			 <h2>Method Chaining and the Ternary Operator<h2>
			<h4>A case study of how to refactor without your brain exploding</h4>
			<h4>Example from W5:Challenge 6, Credit Check-- from 15 lines to 4</h4>
			<p>This week I noticed that plenty of people are using method chains and others aren't. So, I took one section from a solution, and refactored it to show how it's possible to bridge the knowledge gap from mega loops to method chains.</p>
			<p>[FWIW, it used to make me pass out just to look at the method chains, so I thought I'd detail that mental footwork in the hopes that it helps you, too.]</p>
			<p> I took a code sample and, using the same logic, substituted just one method and a ternary operator for a while, each and if/else loop. The code goes from 15 lines to 4 (including def and end). <strong>I know, right?</strong> Is it worth, let me work it...</p><p>Our test subject is the, by now, very familiar credit_check method. Here's the example method:</p>
<pre>
1    def credit_check
2      digits = []
3      counter = 0
4      while counter &#60; @cc.length
5        @cc_number.each do |x|
6          if counter.even?
7            digits &#60;&#60; (x.to_i*2)
8          else
9            digits &#60;&#60; x
10         end
11       counter += 1
12       end
13     end
14     @digits=digits
15   end
</pre>
			<p>Pretty straight ahead, yes? But, for all that we are essentially solving the requirement of: </p><pre>"the code must then double every other digit starting with the next to last"</pre>
			<p>We can have the each_with_index method accomplish what the while and each statements had done, and use a ternary operator in the code block to handle the if/else statement. Check <a href="http://ruby-doc.org/core-2.1.2/Enumerable.html#method-i-each_with_index" target="_blank">the docs</a> for the each_with_index method first, and note that arguments are optional and it will take a block.</p>
			<p>When you look at the documentation, you can see how this method can be applied directly to the logic, is easy to read, and therefore, easier to think about. So, let's use it. But, first, let's look at the ternary operator to give us a way to chunk our if/else.</p>
			<p>Inside the code block the ternary operator allows us to: check a conditional, then do one thing if true, or another if false. Here's the format:</p>
<pre>is_it_true ? it's_true_so_do_x : it's_false_so_do_y</pre>
			<p>Take note, all you need is the "?" and the ":" to separate the components.</p>
			<p>So, then let's see the same logic from above applied with the each_with_index method, ternary operator, and with the previous code commented out, so you can see how everything migrates directly, except counter is traded for index:</p>
<pre width>   def credit_check
1     digits = []
2  #    counter = 0
3  #    while counter &#60; @cc.length
4  #      @cc_number.each do |x|
5  #        if counter.even?
6  #          digits &#60;&#60; (x.to_i*2)
7  #        else
8  #          digits &#60;&#60; x
9  #        end
10 #      counter += 1
11 #      end
12 #    end
13 #  end
14    @digits=digits
15    @cc.each_with_index { |x, i| i.even? ? digits &#60;&#60; (x.to_i*2) : digits &#60;&#60; x }
16    end</pre>
<p>So, what I'm getting at, is that once your logic is solid (and code runs!), get comfortable looking under the hood at the documentation for methods that accomplish your task, paying special note to what they return. Then, comment out your good code and put in new approaches to your refactor.</p><p> I hope that's easy to follow, and that it contributes to your knowledge base.</p>

<p>The entire credit_check method can actually be done in one chain, using the same approach, even if it's not that pleasant looking! 
If you're curious:</p>
<pre>@cc_number.to_s.split(//).each_with_index.map{|e, i| i%2==0 ? e.to_i * 2 : e.to_i}.join.split(//).reduce(:+) % 10 == 0 ? true : false 








</pre>

		</div>

		<div id="footer">
			<h3>Jess Heron</h3>

		</div>

	</body>
</html>





